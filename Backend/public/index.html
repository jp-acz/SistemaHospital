<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Hospitalaria</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <h1>Sistema de Gestión Hospitalaria</h1>
                <p>Administración de Pacientes, Doctores, Citas y Diagnósticos - SQL Server</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navbar">
            <ul>
                <li><a href="#" onclick="showSection('dashboard')" class="active">Dashboard</a></li>
                <li><a href="#" onclick="showSection('crud'); renderCrudForm(document.getElementById('crud-tabla').value)">CRUD</a></li>
                <li><a href="#" onclick="showSection('consultas')">Consultas Avanzadas</a></li>
                <li><a href="#" onclick="showSection('ver-tablas')">Ver Tablas</a></li>
                <li><a href="#" onclick="showSection('api')">API Docs</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Pacientes</h3>
                        <p class="stat-number" id="total-pacientes">--</p>
                        <button onclick="loadPacientes()">Cargar Datos</button>
                    </div>
                    <div class="stat-card">
                        <h3>Bienvenida</h3>
                        <p>Sistema listo para usar. Selecciona una opción del menú.</p>
                        <button onclick="testConnection()">Probar Conexión</button>
                    </div>
                    <div class="stat-card">
                        <h3>Estado del Servidor</h3>
                        <p id="server-status">Comprobando...</p>
                        <button onclick="checkStatus()">Actualizar</button>
                    </div>
                </div>
            </section>

            <!-- Consultas Avanzadas Section -->
            <section id="consultas" class="section">
                <h2>Consultas avanzadas</h2>

                <div class="actions">
                    <button type="button" onclick="cargarConsulta('pacientes-citas')">Pacientes con Citas</button>
                    <button type="button" onclick="cargarConsulta('doctores-estadisticas')">Doctores - Estadísticas</button>
                    <button type="button" onclick="cargarConsulta('pacientes-sin-citas')">Pacientes sin Citas</button>
                    <button type="button" onclick="cargarConsulta('citas-proximas')">Citas próximas</button>
                    <button type="button" onclick="cargarConsulta('diagnosticos-especialidad')">Diagnósticos por especialidad</button>
                    <button type="button" onclick="cargarConsulta('diagnosticos-completos')">Diagnósticos completos</button>
                    <button type="button" onclick="cargarConsulta('seguros-activos')">Seguros activos</button>
                </div>

                <h3 id="consulta-titulo"></h3>
                <p id="consulta-descripcion"></p>
                <div id="consulta-resultado"></div>
            </section>

            <!-- Tablas Section -->
            <div id="ver-tablas" class="section">
            <h2>Visualización de Tablas</h2>
    
            <div class="button-grid">
                <button onclick="cargarTabla('Pacientes')" class="btn">Pacientes</button>
                <button onclick="cargarTabla('Doctores')" class="btn"> Doctores</button>
                <button onclick="cargarTabla('Citas')" class="btn"> Citas</button>
                <button onclick="cargarTabla('Diagnosticos')" class="btn"> Diagnósticos</button>
                <button onclick="cargarTabla('Seguros')" class="btn"> Seguros</button>
                <button onclick="cargarTabla('AuditoriaEliminar')" class="btn">Auditoría</button>
            </div>
    
        <div id="tabla-resultado" class="result-container">
        <div class="empty-state">
            Selecciona una tabla para visualizar su contenido
        </div>
            </div>
        </div>
            <section id="crud" class="section">
    <h2>CRUD</h2>
    <div>
    <label>Tabla:</label>
    <select id="crud-tabla" onchange="renderCrudForm(this.value)">
        <option value="Pacientes">Pacientes</option>
        <option value="Doctores">Doctores</option>
        <option value="Citas">Citas</option>
    </select>
    </div>

    <div style="margin-top:8px;">
    <label>ID (para actualizar/eliminar):</label>
    <input id="crud-id" type="number" min="1" />
    </div>

    <form id="crud-form" onsubmit="return false" style="margin-top:8px;"></form>

    <div style="margin-top:8px;">
    <button onclick="crudCreate()">Crear</button>
    <button onclick="crudUpdate()">Actualizar</button>
    <button onclick="crudDelete()">Eliminar</button>
    </div>

    <div id="crud-msg" style="margin-top:8px;"></div>

    <div id="crud-resultado" style="margin-top:12px;"></div>
</section>

            <!-- API Documentation -->
            <section id="api" class="section">
                <h2>Documentación de API</h2>
                <div class="api-docs">
                    <h3>Endpoints Disponibles</h3>
                    
                    <div class="endpoint">
                        <h4>GET /api/pacientes</h4>
                        <p>Obtener todos los pacientes activos (usa vista SQL)</p>
                        <pre><code>curl http://localhost:3000/api/pacientes</code></pre>
                    </div>
                    
                    <div class="endpoint">
                        <h4>POST /api/pacientes</h4>
                        <p>Crear nuevo paciente (usa Stored Procedure)</p>
                        <pre><code>{
                            "nombre": "Juan Pérez",
                            "edad": 45,
                            "direccion": "Calle Principal 123",
                            "telefono": "555-1234"
                        }</code></pre>
                    </div>
                    
                    <div class="endpoint">
                        <h4>PUT /api/pacientes/:id</h4>
                        <p>Actualizar paciente (usa Stored Procedure)</p>
                        <pre><code>curl -X PUT http://localhost:3000/api/pacientes/1 -d '{...}'</code></pre>
                    </div>

                    <div class="endpoint">
                        <h4>DELETE /api/pacientes/:id</h4>
                        <p>Eliminar paciente - Soft delete (usa Stored Procedure)</p>
                        <pre><code>curl -X DELETE http://localhost:3000/api/pacientes/1</code></pre>
                    </div>
                    
                    <div class="endpoint">
                        <h4>GET /api/consultas/pacientes-citas</h4>
                        <p>Consulta con INNER JOIN (usa vista SQL)</p>
                        <pre><code>curl http://localhost:3000/api/consultas/pacientes-citas</code></pre>
                    </div>
                    
                    <div class="endpoint">
                        <h4>GET /api/consultas/doctores-estadisticas</h4>
                        <p>Estadísticas con GROUP BY (usa vista SQL)</p>
                        <pre><code>curl http://localhost:3000/api/consultas/doctores-estadisticas</code></pre>
                    </div>

                    <div class="endpoint">
                        <h4>GET /api/tablas/:tabla</h4>
                        <p>Ver contenido de cualquier tabla</p>
                        <pre><code>curl http://localhost:3000/api/tablas/Pacientes</code></pre>
                    </div>
                </div>

                <div class="api-docs">
                    <h3>Características SQL Server</h3>
                    <ul>
                        <li>✅ <strong>Triggers:</strong> Auditoría automática de eliminaciones</li>
                        <li>✅ <strong>Stored Procedures:</strong> CRUD de pacientes</li>
                        <li>✅ <strong>Vistas:</strong> Consultas complejas optimizadas</li>
                        <li>✅ <strong>Foreign Keys:</strong> Integridad referencial</li>
                        <li>✅ <strong>Soft Delete:</strong> Eliminación lógica con campo Estado</li>
                    </ul>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer>
            <p>&copy; 2025 Sistema de Gestión Hospitalaria. Todos los derechos reservados.</p>
            <p>Desarrollado con Node.js + Express + SQL Server</p>
        </footer>
    </div>

    <script src="js/script.js" defer></script>

</body>
</html>
