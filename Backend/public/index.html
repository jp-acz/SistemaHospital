<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n Hospitalaria</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <h1>üè• Sistema de Gesti√≥n Hospitalaria</h1>
                <p>Administraci√≥n de Pacientes, Doctores, Citas y Diagn√≥sticos</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navbar">
            <ul>
                <li><a href="#" onclick="showSection('dashboard')" class="active">Dashboard</a></li>
                <li><a href="#" onclick="showSection('pacientes')">Pacientes</a></li>
                <li><a href="#" onclick="showSection('consultas')">üìä Consultas Avanzadas</a></li>
                <li><a href="#" onclick="showSection('api')">API Docs</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <h3>Total Pacientes</h3>
                        <p class="stat-number" id="total-pacientes">--</p>
                        <button onclick="loadPacientes()">Cargar Datos</button>
                    </div>
                    <div class="stat-card">
                        <h3>Bienvenida</h3>
                        <p>Sistema listo para usar. Selecciona una opci√≥n del men√∫.</p>
                        <button onclick="testConnection()">Probar Conexi√≥n</button>
                    </div>
                    <div class="stat-card">
                        <h3>Estado del Servidor</h3>
                        <p id="server-status">Comprobando...</p>
                        <button onclick="checkStatus()">Actualizar</button>
                    </div>
                </div>
            </section>

            <!-- Pacientes Section -->
            <section id="pacientes" class="section">
                <h2>Gesti√≥n de Pacientes</h2>
                
                <!-- Form para crear paciente -->
                <div class="form-container">
                    <h3>Crear Nuevo Paciente</h3>
                    <form id="paciente-form" onsubmit="createPaciente(event)">
                        <div class="form-group">
                            <label>Nombre:</label>
                            <input type="text" id="nombre" required>
                        </div>
                        <div class="form-group">
                            <label>Edad:</label>
                            <input type="number" id="edad" required>
                        </div>
                        <div class="form-group">
                            <label>Direcci√≥n:</label>
                            <input type="text" id="direccion">
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono:</label>
                            <input type="tel" id="telefono">
                        </div>
                        <button type="submit" class="btn-primary">Crear Paciente</button>
                    </form>
                </div>

                <!-- Lista de pacientes -->
                <div class="list-container">
                    <h3>Lista de Pacientes</h3>
                    <button onclick="loadPacientes()" class="btn-secondary">Actualizar Lista</button>
                    <table id="pacientes-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Edad</th>
                                <th>Direcci√≥n</th>
                                <th>Tel√©fono</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Datos se cargan din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Consultas Avanzadas Section -->
            <section id="consultas" class="section">
                <h2>üìä Consultas Avanzadas</h2>
                <div class="consultas-container">
                    <div class="consultas-buttons">
                        <button class="btn-consulta" onclick="cargarConsulta('/api/consultas/pacientes-citas')">
                            üîó Pacientes + Citas (JOIN)
                        </button>
                        <button class="btn-consulta" onclick="cargarConsulta('/api/consultas/doctores-estadisticas')">
                            üìä Estad√≠sticas Doctores
                        </button>
                        <button class="btn-consulta" onclick="cargarConsulta('/api/consultas/pacientes-sin-citas')">
                            ‚ùå Pacientes sin Citas (Subconsulta)
                        </button>
                        <button class="btn-consulta" onclick="cargarConsulta('/api/consultas/citas-proximas')">
                            üìÖ Citas Pr√≥ximas
                        </button>
                        <button class="btn-consulta" onclick="cargarConsulta('/api/consultas/diagnosticos-especialidad')">
                            üè• Diagn√≥sticos por Especialidad (CTE)
                        </button>
                    </div>
                    <div id="resultado-consulta" class="resultado-container"></div>
                </div>
            </section>

            <!-- API Documentation -->
            <section id="api" class="section">
                <h2>Documentaci√≥n de API</h2>
                <div class="api-docs">
                    <h3>Endpoints Disponibles</h3>
                    <div class="endpoint">
                        <h4>GET /api/pacientes</h4>
                        <p>Obtener todos los pacientes</p>
                        <pre><code>curl http://localhost:3000/api/pacientes</code></pre>
                    </div>
                    <div class="endpoint">
                        <h4>POST /api/pacientes</h4>
                        <p>Crear nuevo paciente</p>
                        <pre><code>{
  "nombre": "Juan P√©rez",
  "edad": 45,
  "direccion": "Calle Principal 123",
  "telefono": "555-1234"
}</code></pre>
                    </div>
                    <div class="endpoint">
                        <h4>GET /api/consultas/pacientes-citas</h4>
                        <p>Consulta con INNER JOIN y LEFT JOIN</p>
                        <pre><code>curl http://localhost:3000/api/consultas/pacientes-citas</code></pre>
                    </div>
                    <div class="endpoint">
                        <h4>GET /api/consultas/doctores-estadisticas</h4>
                        <p>Estad√≠sticas con GROUP BY y agregaciones</p>
                        <pre><code>curl http://localhost:3000/api/consultas/doctores-estadisticas</code></pre>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer>
            <p>&copy; 2025 Sistema de Gesti√≥n Hospitalaria. Todos los derechos reservados.</p>
            <p>Desarrollado con Node.js + Express + SQLite</p>
        </footer>
    </div>

    <script src="js/script.js"></script>
    <script>
        function showSection(sectionId) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Actualizar navegaci√≥n
            const links = document.querySelectorAll('.navbar a');
            links.forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        function cargarConsulta(endpoint) {
            const resultDiv = document.getElementById('resultado-consulta');
            resultDiv.innerHTML = '<p>Cargando...</p>';
            
            fetch(endpoint)
                .then(r => r.json())
                .then(d => {
                    let html = '<h3>' + d.titulo + '</h3>';
                    html += '<p><strong>' + d.descripcion + '</strong></p>';
                    html += '<table class="data-table"><thead><tr>';
                    
                    if (d.data.length > 0) {
                        Object.keys(d.data[0]).forEach(key => {
                            html += '<th>' + key + '</th>';
                        });
                        html += '</tr></thead><tbody>';
                        
                        d.data.forEach(row => {
                            html += '<tr>';
                            Object.values(row).forEach(val => {
                                html += '<td>' + (val || 'N/A') + '</td>';
                            });
                            html += '</tr>';
                        });
                    }
                    
                    html += '</tbody></table>';
                    resultDiv.innerHTML = html;
                })
                .catch(e => {
                    resultDiv.innerHTML = '<p style="color: red;">Error: ' + e.message + '</p>';
                    console.error(e);
                });
        }

        function loadPacientes() {
            fetch('/api/pacientes')
                .then(r => r.json())
                .then(d => {
                    const tbody = document.querySelector('#pacientes-table tbody');
                    tbody.innerHTML = '';
                    document.getElementById('total-pacientes').textContent = d.data.length;
                    
                    d.data.forEach(p => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${p.ID}</td>
                            <td>${p.nombre}</td>
                            <td>${p.edad}</td>
                            <td>${p.direccion || 'N/A'}</td>
                            <td>${p.telefono || 'N/A'}</td>
                            <td>
                                <button onclick="editPaciente(${p.ID})">Editar</button>
                                <button onclick="deletePaciente(${p.ID})">Eliminar</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(e => console.error('Error:', e));
        }

        function createPaciente(event) {
            event.preventDefault();
            const nombre = document.getElementById('nombre').value;
            const edad = document.getElementById('edad').value;
            const direccion = document.getElementById('direccion').value;
            const telefono = document.getElementById('telefono').value;
            
            fetch('/api/pacientes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nombre, edad, direccion, telefono })
            })
            .then(r => r.json())
            .then(d => {
                alert('Paciente creado: ' + d.data.nombre);
                document.getElementById('paciente-form').reset();
                loadPacientes();
            })
            .catch(e => alert('Error: ' + e.message));
        }

        function testConnection() {
            fetch('/api/pacientes')
                .then(() => alert('‚úì Conexi√≥n exitosa'))
                .catch(() => alert('‚úó Error en conexi√≥n'));
        }

        function checkStatus() {
            const statusDiv = document.getElementById('server-status');
            fetch('/api/pacientes')
                .then(() => {
                    statusDiv.innerHTML = '‚úì Servidor activo';
                    statusDiv.style.color = 'green';
                })
                .catch(() => {
                    statusDiv.innerHTML = '‚úó Servidor inactivo';
                    statusDiv.style.color = 'red';
                });
        }

        // Cargar datos al iniciar
        window.onload = () => {
            loadPacientes();
            checkStatus();
        };
    </script>

    <style>
        .consultas-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .btn-consulta {
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-consulta:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .resultado-container {
            margin-top: 30px;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            max-height: 600px;
            overflow-y: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }

        .data-table thead {
            background: #333;
            color: white;
        }

        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }

        .data-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        .data-table tbody tr:hover {
            background: #f0f0f0;
        }
    </style>
</body>
</html>
